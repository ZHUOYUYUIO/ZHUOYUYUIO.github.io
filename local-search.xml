<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>mesa-geo introduction(1)</title>
    <link href="/2024/11/12/war-abm-mesageo/"/>
    <url>/2024/11/12/war-abm-mesageo/</url>
    
    <content type="html"><![CDATA[<h1 id="war-spread-model-内战传播模型-："><a href="#war-spread-model-内战传播模型-：" class="headerlink" title="war spread model(内战传播模型)："></a>war spread model(内战传播模型)：</h1><p>A simplified ABM (Agent-Based Model) describing spatial dependency and spatial heterogeneity:</p><ul><li>Spatial dependency: This refers to the phenomenon that an area is more likely to experience civil war if its surrounding areas are experiencing civil war.</li><li>Spatial heterogeneity: Based on existing research, we define spatial heterogeneity as the proximity to the capital. Areas closer to the capital are more prone to war, as the upper echelons of the country often initiate wars and the central government is typically located in the capital.</li></ul><h2 id="import-package"><a href="#import-package" class="headerlink" title="import package"></a>import package</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> mesa <br><span class="hljs-keyword">import</span> mesa_geo <span class="hljs-keyword">as</span> mg<br><span class="hljs-keyword">import</span> mesa_geo.visualization <span class="hljs-keyword">as</span> mgv<br></code></pre></td></tr></table></figure><h2 id="create-regionAgent"><a href="#create-regionAgent" class="headerlink" title="create regionAgent"></a>create regionAgent</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">regionAgent</span>(mg.GeoAgent):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, unique_id, model, geometry, crs,agent_type =<span class="hljs-string">&quot;no_war&quot;</span>,war_infection_risk=<span class="hljs-number">0.1</span> ,war_recovery_rate=<span class="hljs-number">0.2</span></span>):<br>        <span class="hljs-built_in">super</span>().__init__(unique_id, model, geometry, crs)<br>        <span class="hljs-variable language_">self</span>.atype= agent_type<br>        <span class="hljs-variable language_">self</span>.war_infection_risk=war_infection_risk<br>        <span class="hljs-variable language_">self</span>.war_revovery_rate=war_recovery_rate<br>        <span class="hljs-variable language_">self</span>.in_war_step=<span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__repr__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;region&quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-variable language_">self</span>.unique_id)<br>    <br>    <span class="hljs-comment">#If an agent that is not currently engaged in war is within a fixed distance of an agent that is engaged in war</span><br>    <span class="hljs-comment"># there is also a possibility that war may directly occur between them (depending on the threshold set).</span><br>    <span class="hljs-comment"># Agents that are closer to the capital are more likely to experience war (a weight can be set here)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">war_spread</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.atype == <span class="hljs-string">&quot;no_war&quot;</span>:<br>            neighbors= <span class="hljs-variable language_">self</span>.model.space.get_neighbors_within_distance(<br>                <span class="hljs-variable language_">self</span>,<span class="hljs-variable language_">self</span>.model.exposure_distance<br>            )<br><br>            <span class="hljs-keyword">for</span> neighnor <span class="hljs-keyword">in</span> neighbors:<br>            <span class="hljs-comment">#useLdistance(self, agent_a, agent_b)或者agent_a.geometry.distance(agent_b.geometry)</span><br>                A_C_distance=<span class="hljs-variable language_">self</span>.model.space.distance(agent_a=<span class="hljs-variable language_">self</span>, agent_b=<span class="hljs-variable language_">self</span>.model.capitalAgent)<br>                <span class="hljs-keyword">if</span> (neighnor.atype == <span class="hljs-string">&quot;in_war&quot;</span> <br>                    <span class="hljs-keyword">and</span> A_C_distance*<span class="hljs-number">0.001</span>+<span class="hljs-variable language_">self</span>.random.random() &lt; <span class="hljs-variable language_">self</span>.model.threshold_war_infection<br>                    ):<br>                    <span class="hljs-variable language_">self</span>.atype = <span class="hljs-string">&quot;in_war&quot;</span><br>                    <span class="hljs-variable language_">self</span>.in_war_step=<span class="hljs-number">0</span><br>                    <span class="hljs-keyword">break</span><br>        <br>        <span class="hljs-comment">#set step for in-war districts</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-variable language_">self</span>.atype==<span class="hljs-string">&quot;in_war&quot;</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.in_war_step&lt;<span class="hljs-number">3</span>:<br>                <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.random.random() &lt; <span class="hljs-variable language_">self</span>.war_revovery_rate:<br>                    <span class="hljs-variable language_">self</span>.atype = <span class="hljs-string">&quot;no_war&quot;</span><br>                    <span class="hljs-variable language_">self</span>.in_war_step=<span class="hljs-variable language_">self</span>.in_war_step+<span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-variable language_">self</span>.in_war_step=<span class="hljs-number">0</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.war_spread()<br>        <span class="hljs-variable language_">self</span>.model.counts[<span class="hljs-variable language_">self</span>.atype] += <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h2 id="model-part-combine-agents-time-and-space"><a href="#model-part-combine-agents-time-and-space" class="headerlink" title="model part: combine agents, time and space"></a>model part: combine agents, time and space</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_in_war_count</span>(<span class="hljs-params">model</span>):<br>    <span class="hljs-keyword">return</span> model.counts[<span class="hljs-string">&quot;in_war&quot;</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_no_war_count</span>(<span class="hljs-params">model</span>):<br>    <span class="hljs-keyword">return</span> model.counts[<span class="hljs-string">&quot;no_war&quot;</span>]<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">war_model</span>(mesa.Model):<br>    <span class="hljs-comment">#here I just use the data in official file</span><br>    geojson_regions = <span class="hljs-string">&quot;D:\...\TorontoNeighbourhoods.geojson&quot;</span><br>    unique_id = <span class="hljs-string">&quot;HOODNUM&quot;</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,int_war_rate=<span class="hljs-number">0.2</span>,war_revovery_rate=<span class="hljs-number">0.6</span>,threshold_war_infection=<span class="hljs-number">1.5</span>,exposure_distance=<span class="hljs-number">1000</span></span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br>        <br>        <span class="hljs-variable language_">self</span>.int_war_rate=int_war_rate<br>        <span class="hljs-variable language_">self</span>.war_recovery_rate=war_revovery_rate<br>        <span class="hljs-variable language_">self</span>.threshold_war_infection=threshold_war_infection<br>        <span class="hljs-variable language_">self</span>.exposure_distance=exposure_distance<br><br><br>        <span class="hljs-variable language_">self</span>.schedule=mesa.time.RandomActivation(<span class="hljs-variable language_">self</span>)<br>        <span class="hljs-variable language_">self</span>.space=mg.GeoSpace(warn_crs_conversion=<span class="hljs-literal">False</span>)<br>        <span class="hljs-comment">#capital id</span><br>        <span class="hljs-variable language_">self</span>.capital_id=<span class="hljs-number">105</span><br><br><br>        <span class="hljs-variable language_">self</span>.counts=<span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.reset_counts()<br><br>        <span class="hljs-variable language_">self</span>.datacollector = mesa.DataCollector(<br>            &#123;<br>                <span class="hljs-string">&quot;no_war&quot;</span>: get_no_war_count,<br>                <span class="hljs-string">&quot;in_war&quot;</span>: get_in_war_count<br>            &#125;<br>        ) <br><br><br>        ac=mg.AgentCreator(<br>            regionAgent,<br>            model=<span class="hljs-variable language_">self</span>)  <br>        region_agents = ac.from_file(<span class="hljs-variable language_">self</span>.geojson_regions,unique_id=<span class="hljs-variable language_">self</span>.unique_id)<br>        <br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(region_agents)):<br>            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.random.random() &lt; <span class="hljs-variable language_">self</span>.int_war_rate:<br>             <span class="hljs-comment">#if self.random.random() &lt; 0.2:</span><br>                region_agents[j].atype=<span class="hljs-string">&quot;in_war&quot;</span><br><br>        <span class="hljs-variable language_">self</span>.space.add_agents(region_agents)<br><br>        <span class="hljs-comment"># find capital agent id</span><br>        <span class="hljs-variable language_">self</span>.capitalAgent = <span class="hljs-built_in">next</span>((agent <span class="hljs-keyword">for</span> agent <span class="hljs-keyword">in</span> region_agents <span class="hljs-keyword">if</span> agent.unique_id == <span class="hljs-variable language_">self</span>.capital_id), <span class="hljs-literal">None</span>)<br><br><br>        <span class="hljs-keyword">for</span> agent <span class="hljs-keyword">in</span> region_agents:<br>            <span class="hljs-variable language_">self</span>.schedule.add(agent)<br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset_counts</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.counts = &#123;<br>            <span class="hljs-string">&quot;in_war&quot;</span>: <span class="hljs-number">0</span>,<br>            <span class="hljs-string">&quot;no_war&quot;</span>:<span class="hljs-number">0</span><br>            &#125;<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.reset_counts()<br>        <span class="hljs-variable language_">self</span>.schedule.step()<br>        <span class="hljs-variable language_">self</span>.datacollector.collect(<span class="hljs-variable language_">self</span>) <br></code></pre></td></tr></table></figure><h2 id="run-war-spread-model"><a href="#run-war-spread-model" class="headerlink" title="run war spread model"></a>run war spread model</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">model = war_model()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>): <br>    model.step()<br></code></pre></td></tr></table></figure><h2 id="model-visulization"><a href="#model-visulization" class="headerlink" title="model visulization"></a>model visulization</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python">model.datacollector.get_model_vars_dataframe()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">war_model_draw</span>(<span class="hljs-params">agent</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Portrayal Method for canvas</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    portrayal = &#123;&#125;       <br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(agent, regionAgent):<br>        <span class="hljs-keyword">if</span> agent.atype == <span class="hljs-string">&quot;in_war&quot;</span>:<br>            portrayal[<span class="hljs-string">&quot;color&quot;</span>] = <span class="hljs-string">&quot;Red&quot;</span><br>        <span class="hljs-keyword">else</span>: <br>            portrayal[<span class="hljs-string">&quot;color&quot;</span>] = <span class="hljs-string">&quot;green&quot;</span><br>    <br>    <span class="hljs-keyword">return</span> portrayal<br><br><br>model_params = &#123;<br>    <span class="hljs-string">&quot;int_war_rate&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;SliderFloat&quot;</span>,<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-number">0.2</span>,<br>        <span class="hljs-string">&quot;label&quot;</span>: <span class="hljs-string">&quot;Population Size&quot;</span>,<br>        <span class="hljs-string">&quot;min&quot;</span>: <span class="hljs-number">0</span>,<br>        <span class="hljs-string">&quot;max&quot;</span>: <span class="hljs-number">0.6</span>, <br>        <span class="hljs-string">&quot;step&quot;</span>: <span class="hljs-number">0.05</span>,<br>    &#125;,<br>    <span class="hljs-string">&quot;threshold_war_infection&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;SliderFloat&quot;</span>,<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-number">1.5</span>,<br>        <span class="hljs-string">&quot;label&quot;</span>: <span class="hljs-string">&quot;Population Size&quot;</span>,<br>        <span class="hljs-string">&quot;min&quot;</span>: <span class="hljs-number">1.2</span>,<br>        <span class="hljs-string">&quot;max&quot;</span>: <span class="hljs-number">2</span>, <br>        <span class="hljs-string">&quot;step&quot;</span>: <span class="hljs-number">0.1</span>,<br>    &#125;,<br>    <span class="hljs-string">&quot;exposure_distance&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;SliderInt&quot;</span>,<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-number">1000</span>,<br>        <span class="hljs-string">&quot;label&quot;</span>: <span class="hljs-string">&quot;Population Size&quot;</span>,<br>        <span class="hljs-string">&quot;min&quot;</span>: <span class="hljs-number">500</span>,<br>        <span class="hljs-string">&quot;max&quot;</span>: <span class="hljs-number">2000</span>, <br>        <span class="hljs-string">&quot;step&quot;</span>: <span class="hljs-number">100</span>,<br>    &#125;,<br>    <span class="hljs-string">&quot;war_revovery_rate&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;SliderFloat&quot;</span>,<br>      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-number">0.6</span>,<br>        <span class="hljs-string">&quot;label&quot;</span>: <span class="hljs-string">&quot;Maximum Number of Steps to Recover&quot;</span>,<br>        <span class="hljs-string">&quot;min&quot;</span>: <span class="hljs-number">0.1</span>,<br>        <span class="hljs-string">&quot;max&quot;</span>: <span class="hljs-number">1</span>, <br>        <span class="hljs-string">&quot;step&quot;</span>: <span class="hljs-number">0.1</span>,   <br>     &#125;&#125;<br><br>page = mgv.GeoJupyterViz(<br>    war_model,<br>    model_params,<br>    measures= [ [<span class="hljs-string">&quot;in_war&quot;</span>, <span class="hljs-string">&quot;no_war&quot;</span>]],<br>    name=<span class="hljs-string">&quot;war spread&quot;</span>,   <br>    agent_portrayal=war_model_draw,  <br>    zoom=<span class="hljs-number">12</span>,<br>    scroll_wheel_zoom=<span class="hljs-literal">False</span><br>)<br><br></code></pre></td></tr></table></figure><h1 id="visualization-in-the-Jupyter-notebook"><a href="#visualization-in-the-Jupyter-notebook" class="headerlink" title="visualization in the Jupyter notebook"></a>visualization in the Jupyter notebook</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">page<br></code></pre></td></tr></table></figure><h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p>Chen Chong, Hu Jingtian. Spatial Dependence and the Prediction of Armed Conflicts [J]. International Political Science, 2022, 7(2): 86-123.<br><a href="https://cc458.github.io/files/chen_hu_2022qjip.pdf">https://cc458.github.io/files/chen_hu_2022qjip.pdf</a></p>]]></content>
    
    
    <categories>
      
      <category>study share</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ABM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>war_visulization_moran_I</title>
    <link href="/2024/11/12/war_visuliztion/"/>
    <url>/2024/11/12/war_visuliztion/</url>
    
    <content type="html"><![CDATA[<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs r"><span class="hljs-comment">#import the moran&#x27;s I package:</span><br>library<span class="hljs-punctuation">(</span>ape<span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><h2 id="Data-source"><a href="#Data-source" class="headerlink" title="Data source"></a>Data source</h2><p>The conflict events are sourced from the ‘Armed Conflict Location &amp; Event Data Project’ (ACLED) which records the latitude and longitude, time, actors, and casualty numbers of violent events [4]. We selected the ‘battle’ type of conflict event data from the ACLED database. From January 1, 2023, to October 1, 2024, the ACLED database recorded a total of 7,719 relevant war events in East Asia and Southeast Asia.</p><p>import the data</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs r">getwd<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-comment">#you can use it to find the folder </span><br>setwd<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;D:/R-4.3.1/R.SCRIPT/THE COURSE/VISUALIZATION/assignment-10.24/R-code and data&quot;</span><span class="hljs-punctuation">)</span><span class="hljs-comment">#you can change the file directory.</span><br>war_in_asia<span class="hljs-operator">&lt;-</span>read.csv<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;2023-01-01-2024-10-01-East_Asia-Southeast_Asia.csv&quot;</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs r">wardata<span class="hljs-operator">&lt;-</span>data.frame<span class="hljs-punctuation">(</span>war_in_asia<span class="hljs-operator">$</span>fatalities<span class="hljs-punctuation">,</span>war_in_asia<span class="hljs-operator">$</span>latitude<span class="hljs-punctuation">,</span>war_in_asia<span class="hljs-operator">$</span>longitude<span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs r"><span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>war_in_asia<span class="hljs-operator">$</span>region<span class="hljs-punctuation">[</span>war_in_asia<span class="hljs-operator">$</span>region<span class="hljs-operator">==</span><span class="hljs-string">&#x27;Southeast Asia&#x27;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs r">mean<span class="hljs-punctuation">(</span>war_in_asia<span class="hljs-operator">$</span>fatalities<span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs r">median<span class="hljs-punctuation">(</span>war_in_asia<span class="hljs-operator">$</span>fatalities<span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs r">wardata <span class="hljs-operator">&lt;-</span> na.omit<span class="hljs-punctuation">(</span>wardata<span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><h2 id="visualization-of-the-wars"><a href="#visualization-of-the-wars" class="headerlink" title="visualization of the wars"></a>visualization of the wars</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs r"><br>longitude <span class="hljs-operator">&lt;-</span> wardata<span class="hljs-operator">$</span>war_in_asia.longitude<br>latitude <span class="hljs-operator">&lt;-</span> wardata<span class="hljs-operator">$</span>war_in_asia.latitude<br><br>library<span class="hljs-punctuation">(</span>ggplot2<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>ggmap<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>sp<span class="hljs-punctuation">)</span><br>library<span class="hljs-punctuation">(</span>rnaturalearth<span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># load the world data</span><br>world <span class="hljs-operator">&lt;-</span> ne_countries<span class="hljs-punctuation">(</span>scale <span class="hljs-operator">=</span> <span class="hljs-string">&quot;medium&quot;</span><span class="hljs-punctuation">,</span> returnclass <span class="hljs-operator">=</span> <span class="hljs-string">&quot;sf&quot;</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># set the world map</span><br>mp <span class="hljs-operator">&lt;-</span> ggplot<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  geom_sf<span class="hljs-punctuation">(</span>data <span class="hljs-operator">=</span> world<span class="hljs-punctuation">,</span> fill <span class="hljs-operator">=</span> <span class="hljs-string">&quot;gray96&quot;</span><span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> <span class="hljs-string">&quot;gray50&quot;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  coord_sf<span class="hljs-punctuation">(</span>crs <span class="hljs-operator">=</span> <span class="hljs-string">&quot;+proj=longlat +datum=WGS84&quot;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme_void<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># put the point where wars happened</span><br>size_warpoint <span class="hljs-operator">&lt;-</span> wardata<span class="hljs-operator">$</span>war_in_asia.fatalities<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br>color_warpoint <span class="hljs-operator">&lt;-</span> <span class="hljs-punctuation">(</span>wardata<span class="hljs-operator">$</span>war_in_asia.fatalities <span class="hljs-operator">+</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-punctuation">)</span><br><br>mp2 <span class="hljs-operator">&lt;-</span> mp <span class="hljs-operator">+</span><br>  geom_point<span class="hljs-punctuation">(</span>aes<span class="hljs-punctuation">(</span>x <span class="hljs-operator">=</span> longitude <span class="hljs-punctuation">,</span> y <span class="hljs-operator">=</span> latitude<span class="hljs-punctuation">,</span> size <span class="hljs-operator">=</span> size_warpoint<span class="hljs-punctuation">,</span><br>                 color <span class="hljs-operator">=</span> color_warpoint<span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_color_gradient<span class="hljs-punctuation">(</span>low <span class="hljs-operator">=</span> <span class="hljs-string">&quot;pink2&quot;</span><span class="hljs-punctuation">,</span> high <span class="hljs-operator">=</span> <span class="hljs-string">&quot;darkred&quot;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  scale_size<span class="hljs-punctuation">(</span><span class="hljs-built_in">range</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">0.1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">3</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># focus on the research district</span><br>mp3 <span class="hljs-operator">&lt;-</span> mp2 <span class="hljs-operator">+</span><br>  geom_sf<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  coord_sf<span class="hljs-punctuation">(</span>xlim <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">80</span><span class="hljs-punctuation">,</span> <span class="hljs-number">130</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> ylim <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">10</span><span class="hljs-punctuation">,</span> <span class="hljs-number">46</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> expand <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  labs<span class="hljs-punctuation">(</span>title <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Wars in East and Southeast Asia&quot;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>  theme<span class="hljs-punctuation">(</span><br>    axis.title.x <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>margin <span class="hljs-operator">=</span> margin<span class="hljs-punctuation">(</span>t <span class="hljs-operator">=</span> <span class="hljs-number">10</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    axis.title.y <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>angle <span class="hljs-operator">=</span> <span class="hljs-number">90</span><span class="hljs-punctuation">,</span>margin <span class="hljs-operator">=</span> margin<span class="hljs-punctuation">(</span>r <span class="hljs-operator">=</span> <span class="hljs-number">10</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    axis.text.x <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>margin <span class="hljs-operator">=</span> margin<span class="hljs-punctuation">(</span>t <span class="hljs-operator">=</span> <span class="hljs-number">5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    axis.text.y <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>margin <span class="hljs-operator">=</span> margin<span class="hljs-punctuation">(</span>r <span class="hljs-operator">=</span> <span class="hljs-number">5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    panel.grid.major <span class="hljs-operator">=</span> element_line<span class="hljs-punctuation">(</span>color <span class="hljs-operator">=</span> <span class="hljs-string">&quot;gray90&quot;</span><span class="hljs-punctuation">,</span> linewidth <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    panel.grid.minor <span class="hljs-operator">=</span> element_line<span class="hljs-punctuation">(</span>color <span class="hljs-operator">=</span> <span class="hljs-string">&quot;gray95&quot;</span><span class="hljs-punctuation">,</span> linewidth <span class="hljs-operator">=</span> <span class="hljs-number">0.25</span><span class="hljs-punctuation">)</span><br>  <span class="hljs-punctuation">)</span><br><br><span class="hljs-comment"># show the map</span><br>mp3<br></code></pre></td></tr></table></figure><p><img src="/image/bg/wardistributionplot.png"></p><h2 id="moran’s-I-index"><a href="#moran’s-I-index" class="headerlink" title="moran’s I index"></a>moran’s I index</h2><p>This study aims to investigate whether the intensity of wars in the East Asia-Southeast Asia region is related to spatial factors:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs r">warplace.dists <span class="hljs-operator">&lt;-</span> as.matrix<span class="hljs-punctuation">(</span>dist<span class="hljs-punctuation">(</span>cbind<span class="hljs-punctuation">(</span>wardata<span class="hljs-operator">$</span>war_in_asia.latitude<span class="hljs-punctuation">,</span> wardata<span class="hljs-operator">$</span>war_in_asia.longitude<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><br>warplace.dists.inv <span class="hljs-operator">&lt;-</span> 1<span class="hljs-operator">/</span>warplace.dists<br><br>diag<span class="hljs-punctuation">(</span>warplace.dists.inv<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> <span class="hljs-number">0</span><br>warplace.dists.inv<span class="hljs-punctuation">[</span><span class="hljs-built_in">is.infinite</span><span class="hljs-punctuation">(</span>warplace.dists.inv<span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">&lt;-</span> <span class="hljs-number">0</span><br>MoranItest_result<span class="hljs-operator">&lt;-</span>Moran.I<span class="hljs-punctuation">(</span>wardata<span class="hljs-operator">$</span>war_in_asia.fatalities<span class="hljs-punctuation">,</span>warplace.dists.inv<span class="hljs-punctuation">)</span><br><br>MoranItest_result<br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs r">write.csv<span class="hljs-punctuation">(</span>MoranItest_result<span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;moranIoutput.csv&quot;</span><span class="hljs-punctuation">,</span> row.names <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span><span class="hljs-punctuation">)</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>study share</category>
      
    </categories>
    
    
    <tags>
      
      <tag>visulization</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mesa-geo introduction</title>
    <link href="/2024/11/12/mesa-geo-introduction/"/>
    <url>/2024/11/12/mesa-geo-introduction/</url>
    
    <content type="html"><![CDATA[<h1 id="this-is-a-study-share-or-tutorial-for-mesa-geo-study-beginner"><a href="#this-is-a-study-share-or-tutorial-for-mesa-geo-study-beginner" class="headerlink" title="this is a study share or tutorial for mesa-geo study beginner"></a>this is a study share or tutorial for mesa-geo study beginner</h1><h2 id="an-interesting-metaphor"><a href="#an-interesting-metaphor" class="headerlink" title="an interesting metaphor:"></a>an interesting metaphor:</h2><p><img src="/image/bg/blog1.png"><br> （You’re Under Arrest!——anime） Natsumi is a female police officer with short hair, while Miyuki is a female police officer who is driving. They are traffic police officers and spend most of their time executing tasks together, with a smaller portion of time spent separately.</p><p>When executing tasks separately, Miyuki’s greetings to Natsumi:</p><ul><li>Moshi moshi!</li><li>Natsumi, which district of Tokyo are you in now? Are you still on duty there? How far is it from where you are to the Motodome Police Station? What are you planning to do after your shift? Are you heading back to Motodome?</li></ul><p>At this moment, Tokyo is the city where Natsumi and Miyuki are located, but they are in different areas, which can be regarded as neighborhood agents or region agents.</p><p>When we consider Natsumi as a person agent, her name “Natsumi” is actually a unique ID.</p><p>“What are you planning to do after your shift?” can actually be seen as what the next step is, or simply “step”.</p><p>The interaction between Natsumi, Miyuki, and the city constitutes the model among agents. We need to place them and the city into both spatial and temporal sequences.</p><h2 id="1-introduction-of-mesa-geo-package"><a href="#1-introduction-of-mesa-geo-package" class="headerlink" title="1.introduction of mesa-geo package"></a>1.introduction of mesa-geo package</h2><p>mesa-geo is a <strong>python package</strong> which is a extension of mesa package. mesa-geo can help us to conduct Agent based modeling.<br><a href="https://github.com/projectmesa/mesa-geo">https://github.com/projectmesa/mesa-geo</a></p><ul><li>with mesa-geo, we can build build a geosapce which can <strong>contain</strong> or support <strong>gis Agents</strong></li><li>Compared to traditional Agents, geoAgents have more <strong>geometry attributes</strong>: shapely, <strong>CRS</strong> coordinate system…</li></ul><p>the geo_data mesa-geo use:</p><ul><li>we can directly use shapely package to create a geometry object <strong>on our own</strong>.</li><li>we can also import existing geometric objects -&gt; vector data: shp, geojson, geodataframe.</li></ul><p>for example:</p><ul><li>Use the point function from the shapely package to generate corresponding coordinate points for the person agent.</li><li>Directly import the regional data of any place.</li></ul><h2 id="2-the-existing-geometric-data-which-can-be-used-by-mesa-geo"><a href="#2-the-existing-geometric-data-which-can-be-used-by-mesa-geo" class="headerlink" title="2.the existing geometric data which can be used by mesa-geo"></a>2.the existing geometric data which can be used by mesa-geo</h2><h3 id="raster-data"><a href="#raster-data" class="headerlink" title="raster data"></a>raster data</h3><ul><li>Divided into a grid and segmented into individual pixels, which ensures a uniform format and facilitates uniform operations.</li><li>Detailed representation of various features, resulting in large data volumes.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> rasterio  <br><span class="hljs-comment">#open the rasterio  </span><br>ds=rasterio.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;\...\...tif&#x27;</span>) <br></code></pre></td></tr></table></figure><h3 id="vector-data"><a href="#vector-data" class="headerlink" title="vector data"></a>vector data</h3><ul><li>Only stores geographic objects such as points, point lists, and related features, resulting in smaller data volumes.</li><li>Accurately represents point-line-plane elements.</li><li>Facilitates modification and editing.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> geopandas <span class="hljs-keyword">as</span> gpd  <br>gdf = gpd.read_file(<span class="hljs-string">&#x27;\...\...\...shp&#x27;</span>) <br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-comment"># read the geojson data</span><br>file_path = <span class="hljs-string">&#x27;\...geojson&#x27;</span><br>file_path = <span class="hljs-string">&quot;\...\....geojson&quot;</span><br>gdf_0 = gpd.read_file(file_path)<br><br><span class="hljs-comment"># draw the map</span><br>fig, ax = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>))<br>gdf_0.plot(ax=ax, alpha=<span class="hljs-number">0.5</span>, edgecolor=<span class="hljs-string">&#x27;k&#x27;</span>)<br>ax.set_title(<span class="hljs-string">&#x27;regions&#x27;</span>)<br>ax.set_xlabel(<span class="hljs-string">&#x27;Longitude&#x27;</span>)<br>ax.set_ylabel(<span class="hljs-string">&#x27;Latitude&#x27;</span>)<br><br><span class="hljs-comment"># show the map</span><br>plt.show()<br></code></pre></td></tr></table></figure><h2 id="3-what-is-GeoAgent-how-to-use-the-geo-data"><a href="#3-what-is-GeoAgent-how-to-use-the-geo-data" class="headerlink" title="3.what is GeoAgent?&#x2F;how to use the geo_data?"></a>3.what is GeoAgent?&#x2F;how to use the geo_data?</h2><p>what can be done with these geo_data in mesa-geo?</p><p>put the GeoAgents <strong>into the geospace</strong>! this geo_data are the location where agents are. </p><p>however, before we put the GeoAgent into the geospace, let’s figure it out what is GeoAgent.</p><h3 id="GeoAgent"><a href="#GeoAgent" class="headerlink" title="GeoAgent:"></a>GeoAgent:</h3><p>GeoAgent has different kinds of attributes: unique_id, model where the agents are put, geometry, crs</p><p>GeoAgent <strong>can be</strong> buildings, people and others all you hope they have locations in your simulation process.</p><p>GeoAgent can move or change state which are set as rules function</p><p>GeoAgent will have a string of actions as time goes, so agents have step()function </p><h3 id="set-GeoAgent-Class-set-attributes-properties-and-rules-of-agents-action"><a href="#set-GeoAgent-Class-set-attributes-properties-and-rules-of-agents-action" class="headerlink" title="set GeoAgent Class: set attributes(properties) and rules of agents action"></a>set GeoAgent Class: set attributes(properties) and rules of agents action</h3><p>what do attributes, rules fuction and step fuction look like?</p><ul><li>attributes and basic variables</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">regionAgent</span>(mg.GeoAgent):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, unique_id, model, geometry, crs,agent_type =<span class="hljs-string">&quot;no_war&quot;</span>,war_infection_risk=<span class="hljs-number">0.1</span> ,war_recovery_rate=<span class="hljs-number">0.2</span></span>):<br>        <span class="hljs-built_in">super</span>().__init__(unique_id, model, geometry, crs)<br>        <span class="hljs-variable language_">self</span>.atype= agent_type<br>        <span class="hljs-variable language_">self</span>.war_infection_risk=war_infection_risk<br>        <span class="hljs-variable language_">self</span>.war_revovery_rate=war_recovery_rate<br>        <span class="hljs-variable language_">self</span>.in_war_step=<span class="hljs-number">0</span><br>    <span class="hljs-comment">#(p.s.this is from my war spread abm model created by myself, and I will introduce it clearly later)</span><br></code></pre></td></tr></table></figure><ul><li>move function</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">move_point</span>(<span class="hljs-params">self, dx, dy</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        Move a point by creating a new one</span><br><span class="hljs-string">        :param dx:  Distance to move in x-axis</span><br><span class="hljs-string">        :param dy:  Distance to move in y-axis</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> Point(<span class="hljs-variable language_">self</span>.geometry.x + dx, <span class="hljs-variable language_">self</span>.geometry.y + dy)<br><span class="hljs-comment">#this is from official tutorial example</span><br><br></code></pre></td></tr></table></figure><ul><li>state change fuction</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_unhappy</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.is_red:<br>            <span class="hljs-keyword">return</span> (<br>                <span class="hljs-variable language_">self</span>.model.space.get_region_by_id(<span class="hljs-variable language_">self</span>.region_id).red_pct<br>                &lt; <span class="hljs-variable language_">self</span>.SIMILARITY_THRESHOLD<br>            )<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> (<br>                <span class="hljs-number">1</span> - <span class="hljs-variable language_">self</span>.model.space.get_region_by_id(<span class="hljs-variable language_">self</span>.region_id).red_pct<br>            ) &lt; <span class="hljs-variable language_">self</span>.SIMILARITY_THRESHOLD<br><span class="hljs-comment">#this is from official tutorial example</span><br></code></pre></td></tr></table></figure><ul><li>step fuction: which can contains the move or state change rules directly or fuction indirectly.</li><li>which can also contains the time register(observer) function.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-variable language_">self</span>.war_spread()<br>    <span class="hljs-variable language_">self</span>.model.counts[<span class="hljs-variable language_">self</span>.atype] += <span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><h3 id="Allocate-a-location-geographic-object-to-every-GeoAgent"><a href="#Allocate-a-location-geographic-object-to-every-GeoAgent" class="headerlink" title="Allocate a location(geographic object) to every GeoAgent:"></a>Allocate a location(geographic object) to every GeoAgent:</h3><p>what we should do next: is to instantiate the GeoAgent in our model</p><p>there are several ways:</p><ul><li>using the geo_file we methioned</li><li>using the geometry</li></ul><h4 id="using-geo-file"><a href="#using-geo-file" class="headerlink" title="using geo_file"></a>using geo_file</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">ac=mg.AgentCreator(XXAgent, model=<span class="hljs-variable language_">self</span>)<br><br>instantiate_object = ac.from_file(<br>    <span class="hljs-variable language_">self</span>.XXdate,<br>    unique_id=<span class="hljs-string">&quot;name&quot;</span>,<br>    set_attributes=<span class="hljs-literal">True</span><br>)<br></code></pre></td></tr></table></figure><h4 id="using-the-geometry"><a href="#using-the-geometry" class="headerlink" title="using the geometry"></a>using the geometry</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">instantiate_object = mg.AgentCreator(<br>XXAgent,<br>model=<span class="hljs-variable language_">self</span>,<br>crs=<span class="hljs-variable language_">self</span>.space.crs,<br>agent_kwargs=&#123;&#125;<br>)<br><br>point<br>XXobject= unique_shelter.create_agent(<br>    point, <span class="hljs-string">&quot;xx&quot;</span> + <span class="hljs-built_in">str</span>(j),<br>)<br><br></code></pre></td></tr></table></figure><h4 id="put-the-GeoAgent-into-space"><a href="#put-the-GeoAgent-into-space" class="headerlink" title="put the GeoAgent into space"></a>put the GeoAgent into space</h4><p>this is very easy, just put every instantiate_object into the space. it’s OK!</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-variable language_">self</span>.space.add_agents(instantiate_object)<br><br><br></code></pre></td></tr></table></figure><h2 id="4-the-time-and-space-in-mesa-geo"><a href="#4-the-time-and-space-in-mesa-geo" class="headerlink" title="4.the time and space in mesa-geo"></a>4.the time and space in mesa-geo</h2><h3 id="the-time-in-mesa-geo"><a href="#the-time-in-mesa-geo" class="headerlink" title="the time in mesa-geo"></a>the time in mesa-geo</h3><p>the time in mesa-geo is the same as mesa package</p><p>it is relevent to mesa.time this module, let’s go on!</p><ul><li>Core idea, simplified: First, line up the little ones, then let them slide down the slide one by one.</li><li>For each agent, set up a step() function, add the agent to the time series of the schedule, and finally, activate them all uniformly through schedule.step().</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> mesa<br><span class="hljs-keyword">import</span> mesa_geo <span class="hljs-keyword">as</span> mg<br><span class="hljs-comment">#??mesa.time #you can check it yourself</span><br><br></code></pre></td></tr></table></figure><p>the given example without considering spatial arrangement, but focusing only on the changes in steps:</p><p>I have set up a scenario where everyone initially stands in a single line. Each person will take one step forward in their next move. Where will they be after taking 10 steps?</p><p>here are some methods of sheldule of mesa:</p><ul><li>mesa.time.RandomActivation(self)</li><li>mesa.time.SimultaneousActivation(self)</li><li>mesa.time.BaseScheduler(self)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> mesa  <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(mesa.Agent):  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, unique_id: <span class="hljs-built_in">int</span>, model: <span class="hljs-string">&#x27;TestModel&#x27;</span></span>) -&gt; <span class="hljs-literal">None</span>:  <br>        <span class="hljs-built_in">super</span>().__init__(unique_id, model)  <br>        <span class="hljs-variable language_">self</span>.yuyu = <span class="hljs-variable language_">self</span>.random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>) <span class="hljs-comment">#为每一个agent随机分配一个位置</span><br>  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-variable language_">self</span>.yuyu = <span class="hljs-variable language_">self</span>.yuyu+<span class="hljs-number">1</span>  <br>        <span class="hljs-built_in">print</span>(<span class="hljs-variable language_">self</span>.unique_id,<span class="hljs-variable language_">self</span>.yuyu)  <br><br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestModel</span>(mesa.Model):  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-built_in">super</span>().__init__()  <br>        <span class="hljs-comment">#you can try different kinds of methods: just try it!</span><br>        <span class="hljs-variable language_">self</span>.schedule = mesa.time.RandomActivation(<span class="hljs-variable language_">self</span>)<br>        <span class="hljs-comment">#self.schedule = mesa.time.SimultaneousActivation(self)</span><br>        <span class="hljs-comment">#self.schedule = mesa.time.BaseScheduler(self)</span><br>        <span class="hljs-variable language_">self</span>.create_agents()  <br>  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_agents</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):  <br>            personagent = Person(unique_id=i, model=<span class="hljs-variable language_">self</span>)  <br>            <span class="hljs-variable language_">self</span>.schedule.add(personagent)  <br>  <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self</span>):  <br>        <span class="hljs-variable language_">self</span>.schedule.step()  <br>   <br>model = TestModel()  <br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>): <span class="hljs-comment">#here we repeat 10 times</span><br>    model.step()<br><br></code></pre></td></tr></table></figure><h3 id="the-space-in-mesa-geo"><a href="#the-space-in-mesa-geo" class="headerlink" title="the space in mesa-geo"></a>the space in mesa-geo</h3><p>we will use mg.geospace，and this module is created based on geobase</p><p>geospace: initiate the crs(coordinate system) and layers and so on</p><p>geospace fuction:</p><p>basic function：</p><ul><li>to_crs: you can change the crs of space, e.g. change the degree crs into m crs</li><li>agents(self)：Return a list of all agents in the Geospace(agents layer)</li><li>layers(self): Return a list of all layers in the Geospace.</li><li>total_bounds(self): Return the bounds of the GeoSpace in [min_x, min_y, max_x, max_y] format.</li><li><em>geo_interface</em>_(self)</li></ul><p>add or remove agents function：<br>when we want to move the agents, we can use this kind of function</p><ul><li>add_agents(self, agents)：add </li><li>remove_agent(self, agent):remove out</li></ul><p>search for specific agent：<br>when we design the state change fuction or move function, we can use them</p><ul><li>get_relation(self, agent, relation):</li><li>get_intersecting_agents</li><li>get_neighbors_within_distance</li></ul><p>describe the agent distance and relationships：</p><ul><li>agents_at(self, pos)</li><li>distance(self, agent_a, agent_b)</li><li>get_neighbors(self, agent)</li><li>get_agents_as_GeoDataFrame</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#you can check this module yourself, believe in yourself!</span><br><span class="hljs-keyword">import</span> mesa_geo <span class="hljs-keyword">as</span> mg<br><span class="hljs-comment">#??mg.geospace</span><br><br></code></pre></td></tr></table></figure><h2 id="5-Model-the-part-bridge-agents-time-and-space"><a href="#5-Model-the-part-bridge-agents-time-and-space" class="headerlink" title="5.Model: the part bridge agents, time and space"></a>5.Model: the part bridge agents, time and space</h2><p>what you should do is: instantiate all of the GeoAgents and put them into step(time) scheldule and geospace.</p><p>and them, run your instantiated model object, you can wait the agents ‘play with’ each other, it’s so fantastic!</p><h2 id="6-some-tricks"><a href="#6-some-tricks" class="headerlink" title="6.some tricks:"></a>6.some tricks:</h2><h3 id="When-we-need-to-set-up-transitions-between-different-states-for-an-agent"><a href="#When-we-need-to-set-up-transitions-between-different-states-for-an-agent" class="headerlink" title="When we need to set up transitions between different states for an agent:"></a>When we need to set up transitions between different states for an agent:</h3><ul><li>Using if-elif-else syntax can achieve this.</li><li>Setting thresholds and recorders for some states, allowing transitions when certain levels are reached.</li></ul><h3 id="I-want-to-express-in-code-how-to-randomly-generate-two-types-of-objects"><a href="#I-want-to-express-in-code-how-to-randomly-generate-two-types-of-objects" class="headerlink" title="I want to express in code how to randomly generate two types of objects:"></a>I want to express in code how to randomly generate two types of objects:</h3><ul><li>Set a threshold value at 0.5 (or other values).</li><li>Assign a random number to a specific object and check if this random number is greater than or less than the threshold of 0.5 to naturally categorize it.</li><li>For example: is_red &#x3D; random.random() &lt; self.red_percentage.</li></ul><h3 id="To-implement-a-person’s-movement-within-a-circular-area-centered-on-themselves-with-a-radius-of-r"><a href="#To-implement-a-person’s-movement-within-a-circular-area-centered-on-themselves-with-a-radius-of-r" class="headerlink" title="To implement a person’s movement within a circular area centered on themselves with a radius of r:"></a>To implement a person’s movement within a circular area centered on themselves with a radius of r:</h3><ul><li>Assign a random number within the range [0, r] to represent the distance they will move.</li><li>mobility_range &#x3D; self.random.randint(0,self.mobility_range) or self.random.uniform(0, self.mobility_range)</li></ul>]]></content>
    
    
    <categories>
      
      <category>study share</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ABM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Entropy method study</title>
    <link href="/2024/09/04/entropy_study/"/>
    <url>/2024/09/04/entropy_study/</url>
    
    <content type="html"><![CDATA[<hr><h1 id="index-construction-wirh-entropy-method-用熵值法研究指标构建"><a href="#index-construction-wirh-entropy-method-用熵值法研究指标构建" class="headerlink" title="index construction wirh entropy method(用熵值法研究指标构建)"></a>index construction wirh entropy method(用熵值法研究指标构建)</h1><p>熵值法是什么：核心思路就是判断各个指标在所有指标中的地位</p><h2 id="1-dataframe-构造一个简单的指标体系的数据集"><a href="#1-dataframe-构造一个简单的指标体系的数据集" class="headerlink" title="1.dataframe(构造一个简单的指标体系的数据集)"></a>1.dataframe(构造一个简单的指标体系的数据集)</h2><p>we simply select several indicators:<br>简单地选择几个指标：卫生、文化、交通、教育、饮食、环境6个，如下：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs r"><span class="hljs-comment">##先设置几个指标：指标是列j，地区是行i</span><br>indi_health<span class="hljs-operator">&lt;-</span> runif<span class="hljs-punctuation">(</span><span class="hljs-number">50</span><span class="hljs-punctuation">,</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span> <span class="hljs-number">50</span><span class="hljs-punctuation">)</span> <br>indi_culture<span class="hljs-operator">&lt;-</span> runif<span class="hljs-punctuation">(</span><span class="hljs-number">50</span><span class="hljs-punctuation">,</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">16.2</span><span class="hljs-punctuation">)</span><br>indi_jiaotong<span class="hljs-operator">&lt;-</span> runif<span class="hljs-punctuation">(</span><span class="hljs-number">50</span><span class="hljs-punctuation">,</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><span class="hljs-number">200</span><span class="hljs-punctuation">)</span><br>indi_edu<span class="hljs-operator">&lt;-</span>runif<span class="hljs-punctuation">(</span><span class="hljs-number">50</span><span class="hljs-punctuation">,</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span> <span class="hljs-number">50</span><span class="hljs-punctuation">)</span><br>indi_mm<span class="hljs-operator">&lt;-</span>runif<span class="hljs-punctuation">(</span><span class="hljs-number">50</span><span class="hljs-punctuation">,</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span> <span class="hljs-number">50</span><span class="hljs-punctuation">)</span><br>indi_environ<span class="hljs-operator">&lt;-</span>runif<span class="hljs-punctuation">(</span><span class="hljs-number">50</span><span class="hljs-punctuation">,</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span> <span class="hljs-number">50</span><span class="hljs-punctuation">)</span><br><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs r"><span class="hljs-comment">#把这些指标合在一起成为一个df</span><br>df_public1<span class="hljs-operator">&lt;-</span>data.frame<span class="hljs-punctuation">(</span><br>  indi_culture<span class="hljs-punctuation">,</span><br>  indi_edu<span class="hljs-punctuation">,</span><br>  indi_health<span class="hljs-punctuation">,</span><br>  indi_jiaotong<span class="hljs-punctuation">,</span><br>  indi_mm<span class="hljs-punctuation">,</span><br>  indi_environ<br><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><h2 id="2-处理数据：min-max或者z-score方法"><a href="#2-处理数据：min-max或者z-score方法" class="headerlink" title="2.处理数据：min_max或者z_score方法"></a>2.处理数据：min_max或者z_score方法</h2><p>这里我们选择大多数论文中选择的min_max方法</p><p>设置处理数据的函数：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs r">min.max.norm <span class="hljs-operator">&lt;-</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-punctuation">(</span>x<span class="hljs-operator">-</span><span class="hljs-built_in">min</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-operator">/</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">max</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-operator">-</span><span class="hljs-built_in">min</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><span class="hljs-punctuation">&#125;</span><br><br>max.min.norm <span class="hljs-operator">&lt;-</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-punctuation">(</span><span class="hljs-built_in">max</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-operator">-</span>x<span class="hljs-punctuation">)</span><span class="hljs-operator">/</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">max</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-operator">-</span><span class="hljs-built_in">min</span><span class="hljs-punctuation">(</span>x<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br><span class="hljs-punctuation">&#125;</span><br><br>scaledata_z <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>df_public1<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span><span class="hljs-operator">-</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>min.max.norm<span class="hljs-punctuation">)</span>  <span class="hljs-comment">#正向指标</span><br>scaledata_f <span class="hljs-operator">&lt;-</span> apply<span class="hljs-punctuation">(</span>df_public1<span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>max.min.norm<span class="hljs-punctuation">)</span>   <span class="hljs-comment">#负向指标</span><br>  <br>public_1 <span class="hljs-operator">&lt;-</span> cbind<span class="hljs-punctuation">(</span>scaledata_z<span class="hljs-punctuation">,</span>scaledata_f<span class="hljs-punctuation">)</span><br><br></code></pre></td></tr></table></figure><h2 id="3-进入熵值法的函数构建"><a href="#3-进入熵值法的函数构建" class="headerlink" title="3.进入熵值法的函数构建"></a>3.进入熵值法的函数构建</h2><p>$$<br>首先，我们的目的是:得到各指标的权重，从而计算各地区的指标综合得分\<br>权重：w_{j}&#x3D;\frac{g_{j}}{\sum_{j&#x3D;1}^{m}g_{j}} \<br>计算得分：s_{i}&#x3D;100\times(w_{1}p_{i1}+w_{2}p_{i2}+\dots)\<br>变异系数：g_{j}&#x3D;1-e_{j}\<br>熵值：e_{j}&#x3D;-k\sum_{i&#x3D;1}^{n}p_{ij}ln(p_{ij}),k&#x3D;1&#x2F;ln(n)<br>$$</p><h3 id="1-计算指标比重P-ij"><a href="#1-计算指标比重P-ij" class="headerlink" title="(1)$计算指标比重P_{ij}$"></a>(1)$计算指标比重P_{ij}$</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs &#123;r&#125;">first1 &lt;- function(data)<br>&#123;<br>  x &lt;- c(data)<br>  for(i in 1:length(data))<br>    x[i] = data[i]/sum(data[])<br>  return(x)<br>&#125;<br>df_pij &lt;- apply(public_1,2,first1)<br><br></code></pre></td></tr></table></figure><h3 id="2-计算熵值e-j"><a href="#2-计算熵值e-j" class="headerlink" title="(2) $计算熵值e_{j}$"></a>(2) $计算熵值e_{j}$</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs &#123;r&#125;">first2 &lt;- function(data)<br>&#123;<br>  x &lt;- c(data)<br>  for(i in 1:length(data))&#123;<br>    if(data[i] == 0)&#123;<br>      x[i] = 0<br>    &#125;else&#123;<br>      x[i] = data[i] * log(data[i])<br>    &#125;<br>  &#125;<br>  return(x)<br>&#125;<br>dataframe1 &lt;- apply(df_pij,2,first2)<br><br>k &lt;- 1/log(length(dataframe1[,1]))<br>e_j1&lt;- -k * colSums(dataframe1)<br>e_j1<br></code></pre></td></tr></table></figure><h3 id="3-计算差异系数g-j"><a href="#3-计算差异系数g-j" class="headerlink" title="(3) $计算差异系数g_{j}$"></a>(3) $计算差异系数g_{j}$</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs &#123;r&#125;">g_0&lt;- 1-e_j1<br>g_0<br><br></code></pre></td></tr></table></figure><p>此时我们可以明显地看出数值上的不同！！！</p><h3 id="4-计算指标权重w-j"><a href="#4-计算指标权重w-j" class="headerlink" title="(4) $计算指标权重w_{j}$"></a>(4) $计算指标权重w_{j}$</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs &#123;r&#125;">w_j&lt;-g_0/sum(g_0)<br>w_j<br><br></code></pre></td></tr></table></figure><h3 id="5-计算最后各地区的得分s-i"><a href="#5-计算最后各地区的得分s-i" class="headerlink" title="(5) $计算最后各地区的得分s_{i}$"></a>(5) $计算最后各地区的得分s_{i}$</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs &#123;r&#125;">mat3 &lt;- as.matrix(df_pij)<br>mat4&lt;- as.matrix(w_j)<br>si1&lt;-mat3 %*% mat4*100<br>si1<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>study share</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Entropy method</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hello world</title>
    <link href="/2024/09/03/hello-world/"/>
    <url>/2024/09/03/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
